<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Balance Graph</title>
    <!-- Chart.js -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    {% include 'navigation.html' %}

    <div class="nav nav-pills nav-pills-falcon flex-grow-1 mt-2" role="tablist">
        <button class="btn btn-sm active" data-bs-toggle="pill" data-bs-target="#daily-tab" type="button" role="tab" aria-controls="daily-tab" aria-selected="true" id="tab-daily">Total</button>
        <button class="btn btn-sm" data-bs-toggle="pill" data-bs-target="#monthly-tab" type="button" role="tab" aria-controls="monthly-tab" aria-selected="false" id="tab-monthly">Profit(Monthly)</button>
    </div>

    <div class="tab-content">
        <div class="tab-pane fade show active" id="daily-tab" role="tabpanel" aria-labelledby="tab-daily">
            <!-- Daily content here -->
            {% block content %}
            <div class="container mt-4">
                <h1>Total</h1>
                <canvas id="DailyChart"></canvas>
            </div>
            {% endblock %}
        </div>
        <div class="tab-pane fade" id="monthly-tab" role="tabpanel" aria-labelledby="tab-monthly">
            <!-- Monthly content here -->
            <div class="container mt-4">
                <h1>Profit(Monthly)</h1>
                <canvas id="MonthlyChart"></canvas>
            </div>
        </div>
    </div>

    {% block scripts %}
    <script>
        // テンプレートからPythonの変数を取得
        var user_data = {{ user_data|safe }};

        var datasets = [];

        // ユーザーデータを反復処理
        user_data.forEach(function(userData) {
            // 日次利益データセットを作成
            var dailyDataset = {
                label: userData.user.username,
                data: userData.daily_profits,
                // その他の線の設定
            };

            // データセットをdatasetsに追加
            datasets.push(dailyDataset);
        });

        // Chart.jsのデータオブジェクトにdatasetsを追加
        var data = {
            labels: user_data[0].dates, // 最初のユーザーの日付を使用
            datasets: datasets
        };

        // Chart.jsでグラフを描画
        var ctx = document.getElementById('DailyChart').getContext('2d');
        var myChart = new Chart(ctx, {
            type: 'line',
            data: data,
            options: options
        });
    </script>
    {% endblock %}
</body>
</html>
